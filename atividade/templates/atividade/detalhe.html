{% extends "global/base.html" %}

{% block titulo %}
    Detalhes da Atividade
{% endblock %}
{% block content %}
<style>
    body {
        display: block !important;
    }
    
    .detail-container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 40px 20px;
    }
    
    .page-header {
        margin-bottom: 40px;
    }
    
    .page-header h1 {
        font-size: 2rem;
        color: var(--text-light);
        margin: 0 0 12px 0;
        font-weight: 700;
    }
    
    .page-header p {
        margin: 0;
        color: var(--green-light);
        font-size: 1.05rem;
        opacity: 0.9;
    }
    
    .detail-grid {
        display: grid;
        grid-template-columns: 2fr 1fr;
        gap: 24px;
        margin-bottom: 24px;
    }
    
    .section {
        background: #1a1a16;
        padding: 24px;
        border-radius: 12px;
        border: 1px solid rgba(163, 204, 171, 0.15);
        box-shadow: 0 2px 12px rgba(0, 0, 0, 0.3);
    }
    
    .section h2 {
        margin: 0 0 20px 0;
        color: var(--green-light);
        font-size: 1.25rem;
        font-weight: 600;
        display: flex;
        align-items: center;
        gap: 10px;
    }
    
    .section h2 i {
        font-size: 1.1rem;
    }
    
    .campo {
        margin-bottom: 16px;
    }
    
    .campo:last-child {
        margin-bottom: 0;
    }
    
    .label {
        font-weight: 600;
        color: rgba(163, 204, 171, 0.8);
        display: block;
        margin-bottom: 6px;
        font-size: 0.875rem;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }
    
    .valor {
        color: var(--text-light);
        font-size: 1rem;
        line-height: 1.5;
    }
    
    .row {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
    }
    
    .info-card {
        background: rgba(163, 204, 171, 0.05);
        padding: 16px;
        border-radius: 8px;
        border: 1px solid rgba(163, 204, 171, 0.1);
    }
    
    .info-card .label {
        color: var(--green-light);
        margin-bottom: 8px;
    }
    
    .info-card .valor {
        font-size: 1.25rem;
        font-weight: 600;
    }
    
    .item-list {
        background: rgba(163, 204, 171, 0.05);
        padding: 16px;
        margin: 12px 0;
        border-radius: 8px;
        border-left: 3px solid var(--green-medium);
        color: var(--text-light);
    }
    
    .item-list strong {
        color: var(--green-light);
    }
    
    .item-list a {
        color: var(--primary-orange);
        text-decoration: none;
        display: inline-flex;
        align-items: center;
        gap: 6px;
        margin-top: 8px;
        transition: opacity 0.2s;
    }
    
    .item-list a:hover {
        opacity: 0.8;
    }
    
    .status-badge {
        padding: 6px 14px;
        border-radius: 20px;
        font-weight: 600;
        display: inline-block;
        font-size: 0.875rem;
    }
    
    .status-completed {
        background: rgba(16, 185, 129, 0.15);
        color: var(--status-completed);
    }
    
    .status-pending {
        background: rgba(245, 158, 11, 0.15);
        color: var(--status-pending);
    }
    
    .status-delayed {
        background: rgba(239, 68, 68, 0.15);
        color: var(--status-delayed);
    }
    
    .payment-status {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        font-weight: 600;
    }
    
    .payment-status.paga {
        color: var(--status-completed);
    }
    
    .payment-status.nao-paga {
        color: var(--status-delayed);
    }
    
    .actions {
        display: flex;
        justify-content: flex-end;
        gap: 12px;
        padding-top: 24px;
        border-top: 1px solid rgba(163, 204, 171, 0.15);
    }
    
    .btn {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        padding: 12px 24px;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        font-size: 0.95rem;
        font-weight: 600;
        text-decoration: none;
        transition: all 0.3s ease;
    }
    
    .btn-edit {
        background: var(--green-medium);
        color: white;
    }
    
    .btn-edit:hover {
        opacity: 0.9;
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(52, 103, 92, 0.3);
    }
    
    .btn-delete {
        background: var(--status-delayed);
        color: white;
    }
    
    .btn-delete:hover {
        opacity: 0.9;
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(239, 68, 68, 0.3);
    }
    
    .btn-voltar {
        background: rgba(163, 204, 171, 0.1);
        color: var(--text-light);
        border: 1px solid rgba(163, 204, 171, 0.3);
    }
    
    .btn-voltar:hover {
        background: rgba(163, 204, 171, 0.2);
        transform: translateY(-2px);
    }
    
    .vazio {
        color: rgba(163, 204, 171, 0.5);
        font-style: italic;
        text-align: center;
        padding: 20px;
    }
    
    @media (max-width: 768px) {
        .detail-grid {
            grid-template-columns: 1fr;
        }
        
        .row {
            grid-template-columns: 1fr;
        }
        
        .actions {
            flex-direction: column;
        }
        
        .btn {
            width: 100%;
            justify-content: center;
        }
    }
</style>
    <div class="detail-container">
        <div class="page-header">
            <h1>Detalhes da Atividade</h1>
            <p>Visualize todas as informações da atividade</p>
        </div>
        
        <div class="detail-grid">
            <!-- Coluna Principal -->
            <div>
                <!-- Seção de Atividade -->
                <div class="section">
                    <h2><i class="fas fa-clipboard-list"></i> Informações da Atividade</h2>
                    
                    <div class="campo">
                        <div class="label">Descrição</div>
                        <div class="valor">{{ atividade.descricao|default:"Sem descrição" }}</div>
                    </div>
                    
                    <div class="row" style="margin-top: 20px;">
                        <div class="info-card">
                            <div class="label"><i class="fas fa-dollar-sign"></i> Valor Total</div>
                            <div class="valor">R$ {{ atividade.valor|floatformat:2|default:"0,00" }}</div>
                        </div>
                        <div class="info-card">
                            <div class="label"><i class="fas fa-hand-holding-usd"></i> Valor Recebido</div>
                            <div class="valor">R$ {{ atividade.valor_recebido|floatformat:2|default:"0,00" }}</div>
                        </div>
                    </div>
                    
                    <div class="row" style="margin-top: 16px;">
                        <div class="info-card" style="background: {% if atividade.valor_recebido < atividade.valor %}rgba(242, 104, 0, 0.1){% else %}rgba(163, 204, 171, 0.1){% endif %}; border-color: {% if atividade.valor_recebido < atividade.valor %}rgba(242, 104, 0, 0.3){% else %}rgba(163, 204, 171, 0.3){% endif %};">
                            <div class="label"><i class="fas fa-wallet"></i> Valor Restante</div>
                            <div class="valor" style="font-size: 1.25rem; font-weight: 600; color: {% if atividade.valor_recebido < atividade.valor %}var(--primary-orange){% else %}var(--green-light){% endif %};">
                                R$ {% widthratio atividade.valor 1 1 as v %}{% widthratio atividade.valor_recebido -1 1 as vr %}{{ v|add:vr|floatformat:2 }}
                            </div>
                        </div>
                    </div>
                    
                    <div class="row" style="margin-top: 16px;">
                        <div class="campo">
                            <div class="label"><i class="far fa-calendar"></i> Data Prevista</div>
                            <div class="valor">{{ atividade.data_prevista|date:"d/m/Y"|default:"Não informado" }}</div>
                        </div>
                        <div class="campo">
                            <div class="label"><i class="far fa-clock"></i> Hora Prevista</div>
                            <div class="valor">{{ atividade.hora_prevista|date:"H:i"|default:"Não informado" }}</div>
                        </div>
                    </div>
                    
                    <div class="row" style="margin-top: 16px;">
                        <div class="campo">
                            <div class="label"><i class="fas fa-info-circle"></i> Status</div>
                            <div class="valor">
                                <span class="status-badge {% if atividade.status == 'Concluído' %}status-completed{% elif atividade.status == 'Atrasado' %}status-delayed{% else %}status-pending{% endif %}">
                                    {{ atividade.status }}
                                </span>
                            </div>
                        </div>
                        <div class="campo">
                            <div class="label"><i class="fas fa-money-check-alt"></i> Pagamento</div>
                            <div class="valor">
                                <span class="payment-status {% if atividade.is_paga %}paga{% else %}nao-paga{% endif %}">
                                    {% if atividade.is_paga %}<i class="fas fa-check-circle"></i> Paga{% else %}<i class="fas fa-times-circle"></i> Não Paga{% endif %}
                                </span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="campo" style="margin-top: 16px;">
                        <div class="label"><i class="fas fa-layer-group"></i> Ambiente</div>
                        <div class="valor">{% if atividade.ambiente %}{{ atividade.ambiente.nome }}{% else %}Sem ambiente{% endif %}</div>
                    </div>
                    
                    <div class="campo" style="margin-top: 16px;">
                        <div class="label"><i class="far fa-calendar-plus"></i> Data de Criação</div>
                        <div class="valor">{{ atividade.data_criacao|date:"d/m/Y"|default:"Não informado" }}</div>
                    </div>
                </div>

                <!-- Seção de Referências -->
                <div class="section" style="margin-top: 24px;">
                    <h2><i class="fas fa-paperclip"></i> Referências Visuais</h2>
                    {% if referencias %}
                        {% for referencia in referencias %}
                            <div class="item-list">
                                <div style="display: flex; justify-content: space-between; align-items: center;">
                                    <div>
                                        <strong>{{ referencia.tipo }}</strong>
                                        <div style="color: rgba(163, 204, 171, 0.7); font-size: 0.875rem; margin-top: 4px;">
                                            {{ referencia.nome_arquivo }}
                                        </div>
                                    </div>
                                    {% if referencia.arquivo %}
                                        <div style="display:flex; gap:12px;">
                                            <a href="{{ referencia.arquivo.url }}" target="_blank" rel="noopener">
                                                <i class="fas fa-eye"></i> Visualizar
                                            </a>
                                            <a href="{% url 'download_referencia' referencia.id %}">
                                                <i class="fas fa-download"></i> Baixar
                                            </a>
                                        </div>
                                    {% endif %}
                                </div>
                            </div>
                        {% endfor %}
                    {% else %}
                        <div class="vazio">Nenhuma referência visual cadastrada.</div>
                    {% endif %}
                </div>
            </div>
            
            <!-- Coluna Lateral -->
            <div>
                <!-- Seção de Cliente -->
                <div class="section">
                    <h2><i class="fas fa-user"></i> Cliente</h2>
                    {% if cliente %}
                        <div class="campo">
                            <div class="label"><i class="fas fa-id-card"></i> Nome</div>
                            <div class="valor">{{ cliente.nome }}</div>
                        </div>
                        
                        <div class="campo">
                            <div class="label"><i class="fas fa-envelope"></i> Email</div>
                            <div class="valor">{{ cliente.email|default:"Não informado" }}</div>
                        </div>
                        
                        <div class="campo">
                            <div class="label"><i class="fas fa-phone"></i> Telefone</div>
                            <div class="valor">{{ cliente.telefone|default:"Não informado" }}</div>
                        </div>
                        
                        {% if cliente.sobre %}
                        <div class="campo">
                            <div class="label"><i class="fas fa-info-circle"></i> Sobre</div>
                            <div class="valor">{{ cliente.sobre }}</div>
                        </div>
                        {% endif %}
                    {% else %}
                        <div class="vazio">Nenhum cliente associado a esta atividade.</div>
                    {% endif %}
                </div>
                
                <!-- Seção de Endereços -->
                <div class="section" style="margin-top: 24px;">
                    <h2><i class="fas fa-map-marker-alt"></i> Endereços</h2>
                    {% if cliente and enderecos %}
                        {% for endereco in enderecos %}
                            <div class="item-list">
                                <strong><i class="fas fa-map-pin"></i> {{ endereco.rua }}, {{ endereco.numero|default:"S/N" }}</strong>
                                {% if endereco.complemento %}
                                <div style="margin-top: 4px; color: rgba(163, 204, 171, 0.8);">
                                    {{ endereco.complemento }}
                                </div>
                                {% endif %}
                                <div style="margin-top: 8px; color: rgba(163, 204, 171, 0.8);">
                                    {{ endereco.cidade }}, {{ endereco.estado }}
                                </div>
                                <div style="margin-top: 4px; color: rgba(163, 204, 171, 0.8);">
                                    <strong>CEP:</strong> {{ endereco.cep }}
                                </div>
                            </div>
                        {% endfor %}
                    {% else %}
                        <div class="vazio">Nenhum endereço cadastrado.</div>
                    {% endif %}
                </div>
            </div>
        </div>
        
        <!-- Botões de ação -->
        <div class="section">
            <div class="actions">
                {% if ambiente_id %}
                    <a href="{% url 'atividades_por_ambiente' ambiente_id %}" class="btn btn-voltar">
                        <i class="fas fa-arrow-left"></i> Voltar
                    </a>
                {% else %}
                    <a href="{% url 'home' %}" class="btn btn-voltar">
                        <i class="fas fa-arrow-left"></i> Voltar
                    </a>
                {% endif %}
                <a href="{% url 'editar_atividade' atividade.id %}" class="btn btn-edit">
                    <i class="fas fa-edit"></i> Editar
                </a>
                <a href="{% url 'deletar_atividade' atividade.id %}" class="btn btn-delete">
                    <i class="fas fa-trash-alt"></i> Excluir
                </a>
            </div>
        </div>
    </div>
{% endblock %}